<!doctype html>
<html>
<head>
	<title>Infection Project</title>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<style>
		.node{
			stroke: #fff;
			stroke-width: 1px;
		}

		.link{
			stroke: #999;
			stroke-opacity: 0.6;
		}
	</style>
</head>
<body>

	<script>
		
		
		console.log("Performing setup");

		var width = 960,
			height = 500;

		var force = d3.layout.force()
			.charge(-120)
			.linkDistance(30)
			.size([width, height]);

		var svg = d3.select("body")
			.append("svg")
			.attr("width", width)
			.attr("height", height);

		var xhttp;
		if(window.XMLHttpRequest){
			xhttp = new XMLHttpRequest();
		}

		// The function called when the response for the graph is received
		xhttp.onreadystatechange = function(){
			if(xhttp.readyState == 4 && xhttp.status == 200){

				graph = JSON.parse(xhttp.responseText);
				processGraph(graph);
			}
		}

		xhttp.open("GET", "graph/main", true);
		xhttp.send();

		function processGraph(graph){
			console.log("Processing graph.");

			var nodes = graph.nodes;
			var links = graph.links;

			force.nodes(nodes)
				.links(links)
				.start();

			var link = svg.selectAll(".link")
				.data(links)
				.enter()
				.append("line")
				.attr("class", "link")
				.style("stroke-width", 1);

			var node = svg.selectAll(".node")
				.data(nodes)
				.enter()
				.append("circle")
				.attr("class", "node")
				.attr("r", 5)
				.style("fill", "green")
				.call(force.drag);

			force.on("tick", function(){
				link.attr("x1", function(d){ return d.source.x; })
					.attr("y1", function(d){ return d.source.y; })
					.attr("x2", function(d){ return d.target.x; })
					.attr("y2", function(d){ return d.target.y; });

				node.attr("cx", function(d){ return d.x; })
					.attr("cy", function(d){ return d.y; });
			});
		}



	</script>
</body>
</html>